---
title: DSP知识整理
---
# 一、DSP概述
### 硬件：
- 高速控制和信号处理
- 采用流水线操作
- 采用哈佛结构，数据存储区和程序存储区分离，数据总线和程序总线也是分开的
- 大多配有硬件乘法器和加法器，同一时钟周期内可以完成累加和累乘
- 零开销循环

### 软件：
- 显示MAC（乘加器）指令
- 精简指令集
- 专门的寻址方式

### DSP分类
按数据格式分：
- 定点
- 浮点

按用途分：
- 通用
- 专用

# 二、TMS320F2812

### CPU
- 32位定点CPU
- 150MHz
- 当频率为135MHz时，核心电压1.8V；当频率为150MHz时，核心电压为1.9V；输出IO口电压为3.3V
### 内存
- 18kW RAM
- 128kW Flash

### 外设功能模块
- 控制类
  - IO
  - 定时器
  - PWM

- 测量类
  - 数字：捕获、正交编码
  - 模拟：ADC

- 通讯类
  - UART
  - eCAN
  - SPI
  - McBsp

### 其他
外设中断扩展模块（PIE）
- 支持45个外部中断

片上存储器
- 128kW Flash
- 1kW的OTP型存储器
- 18kW的SARAM
  - L0和L1：两个4kW的SARAM
  - H0: 8kW
  - M0和M1：两个1kW的SARAM
- 56个可编程IO口
- 时钟和系统控制
- 3个32位CPU定时器
- 马达控制外设
  - 两个事件管理器
- 12位ADC，16通道

### 寻址方式 
1. 直接寻址
2. 间接寻址
3. 寄存器寻址
4. 堆栈寻址
5. 数据/地址/IO空间立即寻址方式
6. 程序空间间接寻址方式

### C28x流水线
- 八级流水线，五个阶段
- 取指令，译码，读取数据，执行，写回

# 三、时钟和系统控制
![OSC&PLL](../img/DSP/OSC&PLL.png)
时钟CLKIN的来源有两种，一种是外部晶振提供，另一种是外部时钟输入。可以通过引脚<span style="text-decoration: overline">XF_PLLDIS</span>来控制选择。
- 晶振：20MHz ~ 35MHz
- 外部时钟：有PLL: 5 ~ 100MHz；无PLL: 4 ~ 150MHz

在使用对应的外设之前，需要使能它们的时钟。与外设时钟使能相关的寄存器是<u>外设时钟使能寄存器PCLKCR</u>。

SYSCLK经过分频可以得到低速外设时钟LSPCLK和高速外设时钟HSPCLK，它们互相独立，分别给高速外设和低速外设供应时钟信号。

### 看门狗电路
当八位的<u>看门狗加法计数器WDCNTR</u>达到最大值时，看门狗模块输出一个512个周期的脉冲，使系统复位。

如果不想使用看门狗，可以直接禁止看门狗。

如果启用了看门狗，当程序正常运行时，我们需要定期向WDCNTR依次顺序写入0x55和0xAA来清零，实现“喂狗”操作。

逻辑校验位是看门狗的另一个安全机制，访问<u>看门狗控制器WDCR</u>的写操作中，相应的校验位必须为“101”，否则会立即拒绝访问并引发系统复位。

### 低功耗模式
- 空闲模式：CPU进入低功耗模式，部分外设不使用时时钟选择性关闭，会自动降低频率来降低功耗，任何使能的外设中断都可以唤醒此模式。
- 暂停模式：片上所有设备停止工作
- 备用模式：关闭CPU和外设时钟，OSC和PLL正常工作

# 四、CPU定时器
x2812内部有3个32位的CPU定时器，其中只有Timer0可供用户使用，Timer1和Timer2都被系统保留。


